<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>SmartBus - Gateway</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; }
    button { padding: 8px 12px; cursor: pointer; }
    input { padding: 8px; width: 100%; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 8px; overflow:auto; }
  </style>
</head>
<body>
  <h1>SmartBus (Distribuido) - Demo</h1>
  <p>Frontend simple servido por el Gateway. El Gateway consume routes-service y telemetry-service usando DNS interno de Docker.</p>

  <div class="grid">
    <div class="card">
      <h2>Rutas</h2>
      <button onclick="loadRoutes()">Cargar rutas</button>
      <pre id="routesOut">...</pre>
    </div>

    <div class="card">
      <h2>Telemetr√≠a</h2>
      <button onclick="loadBuses()">Listar buses</button>
      <pre id="busesOut">...</pre>

      <h3>Actualizar bus (publica evento a RabbitMQ)</h3>
      <label>Bus ID</label>
      <input id="busId" value="BUS-001" />
      <label>lat</label>
      <input id="lat" value="-0.1810" />
      <label>lon</label>
      <input id="lon" value="-78.4680" />
      <label>occupancy</label>
      <input id="occ" value="15" />
      <button onclick="updateBus()">Enviar update</button>
      <pre id="updateOut">...</pre>
    </div>
  </div>

  <p>RabbitMQ UI: <a href="http://localhost:15672" target="_blank">http://localhost:15672</a> (guest/guest)</p>

<script>
async function loadRoutes() {
  const res = await fetch('/api/routes');
  document.getElementById('routesOut').textContent = JSON.stringify(await res.json(), null, 2);
}

async function loadBuses() {
  const res = await fetch('/api/buses');
  document.getElementById('busesOut').textContent = JSON.stringify(await res.json(), null, 2);
}

async function updateBus() {
  const busId = document.getElementById('busId').value;
  const body = {
    lat: parseFloat(document.getElementById('lat').value),
    lon: parseFloat(document.getElementById('lon').value),
    occupancy: parseInt(document.getElementById('occ').value, 10),
  };
  const res = await fetch(`/api/buses/${busId}/update`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body)
  });
  document.getElementById('updateOut').textContent = JSON.stringify(await res.json(), null, 2);
}
</script>
</body>
</html>
